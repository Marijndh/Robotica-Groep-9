import numpy as np


# For 2R Manipulator
class Kinematics:
    def __init__(self, link1, link2, range_l1, range_l2):
        self.Link1 = link1
        self.Link2 = link2
        # Define the angle limits in radians
        self.theta1_min = np.deg2rad(-range_l1)
        self.theta1_max = np.deg2rad(range_l1)
        self.theta2_min = np.deg2rad(-range_l2)
        self.theta2_max = np.deg2rad(range_l2)

    def inverse_kinematics(self, y, x):
        # Calculate Distance
        distance = (x ** 2 + y ** 2 - self.Link1 ** 2 - self.Link2 ** 2) / (2 * self.Link1 * self.Link2)

        # Ensure the distance is within the valid range for arccos
        if distance < -1 or distance > 1:
            raise ValueError("Target is out of reach")

        # Calculate Elbow Angle
        theta2 = np.arccos(distance)

        # Adjust the angle based on the y coordinate
        if y < 0:
            theta2 = -theta2

        # Calculate Shoulder Angle
        theta1 = np.arctan2(y, x) - np.arctan2(self.Link2 * np.sin(theta2), self.Link1 + self.Link2 * np.cos(theta2))

        # Clamp the angles to their respective limits
        theta1 = np.clip(theta1, self.theta1_min, self.theta1_max)
        theta2 = np.clip(theta2, self.theta2_min, self.theta2_max)

        return np.rad2deg(theta1), np.rad2deg(theta2)
